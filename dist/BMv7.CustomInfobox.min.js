/*
* BMv7.CustomInfobox - v1.0.1 - 03-21-2013
* URL: http://russ0519.github.com/BMv7.CustomInfobox
*/

var CustomInfobox=function(o,t){function r(){p=o.getRootElement().parentNode.id+"_infobox",e(f.tether),s(t),$("body").append("<div id='"+p+"' class='"+f.containerClass+"' style='position:absolute;z-index:10000;display:none;border:1px solid "+f.containerBorderColor+"'></div>")}function n(o){var t=["<div id='",p,"_arrow'  class='"+f.arrowClass+"' style='position:relative;float:left;width:0;height:0;line-height:0;border-style:solid;"],r=.5*f.arrowWidth;switch(o){case 0:t.push("border-width:0 ",r,"px ",f.arrowLength,"px ",r,"px;"),t.push("border-color:transparent transparent ",f.arrowColor," transparent;");break;case 1:t.push("border-width:",r,"px 0 ",r,"px ",f.arrowLength,"px;"),t.push("border-color:transparent transparent transparent ",f.arrowColor,";");break;case 2:t.push("border-width:",f.arrowLength,"px ",r,"px 0 ",r,"px;"),t.push("border-color:",f.arrowColor," transparent transparent transparent;");break;case 3:t.push("border-width:",r,"px ",f.arrowLength,"px ",r,"px 0;"),t.push("border-color:transparent ",f.arrowColor," transparent transparent;")}return t.push("'></div>"),t.join("")}function e(o){null!==c&&Microsoft.Maps.Events.removeHandler(c),c=o?Microsoft.Maps.Events.addThrottledHandler(l,"viewchange",i,40):Microsoft.Maps.Events.addHandler(l,"viewchangestart",a)}function a(){h=null,d=null,i()}function i(){var o=$("#"+p);if(null!==o&&null!==h&&null!==d)if(l.getBounds().contains(h)){o.css("display","");var t=l.tryLocationToPixel(h,Microsoft.Maps.PixelReference.control),r=l.getPageX()+t.x,e=l.getPageY()+t.y,i=.5*l.getHeight()<t.y?2:0;i+=.5*l.getWidth()<t.x?1:0;var s,c=["<div id='",p,"_content'  class='"+f.contentClass+"' style='position:relative;float:left;border:1px solid ",f.borderColor,";background-color:",f.color,";min-width:",f.minWidth,"px;min-height:",f.minHeight,"px;'>",d,"</div>"],u=0,w=0;f.showArrow?f.orientation?(u=f.arrowWidth,w=f.arrowLength,s=i>1?c.join("")+n(2):n(0)+c.join("")):(u=f.arrowLength,w=f.arrowWidth,s=i%2?c.join("")+n(1):n(3)+c.join("")):s=c.join(""),o.html(s);var x=$("#"+p+"_content");f.showCloseButton&&(x.append("<span id='"+p+"_closeBtn' class='"+f.closeButtonClass+"' href='javascript:void()' style='position:absolute;right:0px;top:0px;cursor:pointer;font:bold 18px Arial;line-height:12px;color:"+f.closeButtonColor+";padding:"+f.closeButtonPadding+"'>x</span>"),$("#"+p+"_closeBtn").click(function(){a()}));var g=x.outerWidth(),v=x.outerHeight(),C=0,b=0,m=0,y=0;if(f.orientation?(C=g,b=v+w,i%2?(y=C-f.arrowWidth,r+=f.offset.x-C+.5*f.arrowWidth):r+=f.offset.x-.5*f.arrowWidth,e-=i>1?b+f.offset.y:f.offset.y):(C=u+g,b=Math.max(v,w),r+=i%2?-f.offset.x-C:f.offset.x,i>1?(m=b-f.arrowWidth,e-=b-.5*f.arrowWidth+f.offset.y):e-=.5*f.arrowWidth+f.offset.y),f.showArrow){var B=$("#"+p+"_arrow");B.css({"margin-left":Math.ceil(y)+"px","margin-top":Math.ceil(m)+"px"})}o.css({width:Math.ceil(C)+"px",height:Math.ceil(b)+"px",top:e,left:r})}else o.css("display","none");else null!==o&&(o.html(""),o.css("display","none"))}function s(o){var t=f.tether;for(var r in o)f[r]=o[r];t!=f.tether&&e(f.tether),i()}var l=o,d=null,h=null,p=null,c=null,f={arrowColor:"#fff",arrowLength:20,arrowWidth:30,borderColor:"#000",color:"#fff",closeButtonColor:"#000",closeButtonPadding:"2px 5px 0 0",containerBorderColor:"#000",minHeight:50,minWidth:100,offset:{x:0,y:0},orientation:0,showArrow:!0,showCloseButton:!0,tether:!1,containerClass:"mapInfoBoxContainer",contentClass:"mapInfoBoxContent",closeButtonClass:"mapInfoBoxCloseButton",arrowClass:"mapInfoBoxArrow"};this.hide=function(){a()},this.show=function(o,t){h=o,d=t,i()},this.getOptions=function(){return f},this.setOptions=function(o){s(o)},r()};Microsoft.Maps.moduleLoaded("CustomInfoboxModule");